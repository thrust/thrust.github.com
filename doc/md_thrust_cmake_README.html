<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Thrust: Using Thrust with CMake</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Thrust
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Using Thrust with CMake </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Thrust provides configuration files that simplify using Thrust from other CMake projects. Requirements:</p>
<ul>
<li>Thrust &gt;= 1.9.10</li>
<li>CMake &gt;= 3.15</li>
</ul>
<p>See the <a href="#fixing-legacy-findthrustcmake">Fixing Legacy FindThrust.cmake</a> section for solutions that work on older Thrust versions.</p>
<h2>User Guide</h2>
<h4>Default Configuration (CUDA)</h4>
<p>Thrust is configured using a <code>thrust_create_target</code> CMake function that assembles a complete interface to the Thrust library:</p>
<div class="fragment"><div class="line">find_package(Thrust REQUIRED CONFIG)</div><div class="line">thrust_create_target(Thrust)</div><div class="line">target_link_libraries(MyProgram Thrust)</div></div><!-- fragment --><p>The first argument is the name of the interface target to create, and any additional options will be used to configure the target. By default, <code>thrust_create_target</code> will configure its result to use CUDA acceleration.</p>
<p>If desired, <code>thrust_create_target</code> may be called multiple times to build several unique Thrust interface targets with different configurations, as detailed below.</p>
<p><b>Note:</b> If CMake is unable to locate Thrust, specify the path to Thrust's CMake configuration directory (where this README file is located) as <code>Thrust_DIR</code>. If cloning Thrust from github, this would be</p>
<div class="fragment"><div class="line">$ cmake . -DThrust_DIR=&lt;thrust git repo root&gt;/thrust/cmake/</div></div><!-- fragment --><h4>TBB / OpenMP</h4>
<p>To explicitly specify host/device systems, <code>HOST</code> and <code>DEVICE</code> arguments can be passed to <code>thrust_create_target</code>. If an explicit system is not specified, the target will default to using CPP for host and/or CUDA for device.</p>
<div class="fragment"><div class="line">thrust_create_target(ThrustTBB DEVICE TBB)</div><div class="line">thrust_create_target(ThrustOMP HOST CPP DEVICE OMP)</div></div><!-- fragment --><p>will create targets <code>ThrustTBB</code> and <code>ThrustOMP</code>. Both will use the serial <code>CPP</code> host system, but will find and use TBB or OpenMP for the device system.</p>
<h4>Configure Target from Cache Options</h4>
<p>To allow a Thrust target to be configurable easily via <code>cmake-gui</code> or <code>ccmake</code>, pass the <code>FROM_OPTIONS</code> flag to <code>thrust_create_target</code>. This will add <code>THRUST_HOST_SYSTEM</code> and <code>THRUST_DEVICE_SYSTEM</code> options to the CMake cache that allow selection from the systems supported by this version of Thrust.</p>
<div class="fragment"><div class="line">thrust_create_target(Thrust FROM_OPTIONS</div><div class="line">  [HOST_OPTION &lt;option name&gt;]</div><div class="line">  [DEVICE_OPTION &lt;option name&gt;]</div><div class="line">  [HOST_OPTION_DOC &lt;doc string&gt;]</div><div class="line">  [DEVICE_OPTION_DOC &lt;doc string&gt;]</div><div class="line">  [HOST &lt;default host system name&gt;]</div><div class="line">  [DEVICE &lt;default device system name&gt;]</div><div class="line">  [ADVANCED]</div><div class="line">)</div></div><!-- fragment --><p>The optional arguments have sensible defaults, but may be configured per <code>thrust_create_target</code> call:</p>
<table class="doxtable">
<tr>
<th>Argument </th><th>Default </th><th>Description  </th></tr>
<tr>
<td><code>HOST_OPTION</code> </td><td><code>THRUST_HOST_SYSTEM</code> </td><td>Name of cache option for host </td></tr>
<tr>
<td><code>DEVICE_OPTION</code> </td><td><code>THRUST_DEVICE_SYSTEM</code> </td><td>Name of cache option for device </td></tr>
<tr>
<td><code>HOST_OPTION_DOC</code> </td><td>Thrust's host system. </td><td>Docstring for host option </td></tr>
<tr>
<td><code>DEVICE_OPTION_DOC</code> </td><td>Thrust's device system. </td><td>Docstring for device option </td></tr>
<tr>
<td><code>HOST</code> </td><td><code>CPP</code> </td><td>Default host system </td></tr>
<tr>
<td><code>DEVICE</code> </td><td><code>CUDA</code> </td><td>Default device system </td></tr>
<tr>
<td><code>ADVANCED</code> </td><td><em>N/A</em> </td><td>Mark cache options advanced </td></tr>
</table>
<h3>Specifying Thrust Version Requirements</h3>
<p>A specific version of Thrust may be required in the <code>find_package</code> call:</p>
<div class="fragment"><div class="line">find_package(Thrust 1.9.10)</div></div><!-- fragment --><p>will only consider Thrust installations with version <code>1.9.10.X</code>. An exact match down to the patch version can be forced by using <code>EXACT</code> matching:</p>
<div class="fragment"><div class="line">find_package(Thrust 1.9.10.1 EXACT)</div></div><!-- fragment --><p>would only match the 1.9.10.1 release.</p>
<h4>Using a Specific TBB or OpenMP Environment</h4>
<p>When <code>thrust_create_target</code> is called, it will lazily load the requested systems on-demand through internal <code>find_package</code> calls. If a project already uses TBB or OpenMP, it may specify a CMake target for Thrust to share instead:</p>
<div class="fragment"><div class="line">thrust_set_TBB_target(MyTBBTarget)</div><div class="line">thrust_set_OMP_target(MyOMPTarget)</div></div><!-- fragment --><p>These functions must be called <b>before</b> <code>thrust_create_target</code>, and will have no effect if the dependency is loaded as a <code>find_package(Thrust COMPONENT [...])</code> component.</p>
<h4>Testing for Systems</h4>
<p>The following functions check if a system has been found, either by lazy loading through <code>thrust_create_target</code> or as a <code>find_package</code> <code>COMPONENT</code> / <code>OPTIONAL_COMPONENT</code>:</p>
<div class="fragment"><div class="line"># Set var_name to TRUE or FALSE if an individual system has been found:</div><div class="line">thrust_is_cuda_system_found(&lt;var_name&gt;)</div><div class="line">thrust_is_cpp_system_found(&lt;var_name&gt;)</div><div class="line">thrust_is_tbb_system_found(&lt;var_name&gt;)</div><div class="line">thrust_is_omp_system_found(&lt;var_name&gt;)</div><div class="line"></div><div class="line"># Generic version that takes a component name from CUDA, CPP, TBB, OMP:</div><div class="line">thrust_is_system_found(&lt;component_name&gt; &lt;var_name&gt;)</div><div class="line"></div><div class="line"># Defines `THRUST_*_FOUND` variables in the current scope that reflect the</div><div class="line"># state of all known systems. Can be used to refresh these flags after</div><div class="line"># lazy system loading.</div><div class="line">thrust_update_system_found_flags()</div></div><!-- fragment --><h4>Debugging</h4>
<p>Thrust will produce a detailed log describing its targets, cache options, and interfaces when <code>--log-level=VERBOSE</code> is passed to CMake 3.15.7 or newer:</p>
<div class="fragment"><div class="line">$ cmake . --log-level=VERBOSE</div></div><!-- fragment --><p>This can be handy for inspecting interface and dependency information.</p>
<h2>Fixing Legacy FindThrust.cmake</h2>
<p>A community-created <code>FindThrust.cmake</code> module exists and is necessary to find Thrust installations prior to Thrust 1.9.10. Its usage is discouraged whenever possible and the config files in this directory should be strongly preferred. However, projects that need to support old versions of Thrust may still need to use the legacy <code>FindThrust.cmake</code> with pre-1.9.10 installations.</p>
<p>One popular flavor of this find module has a version parsing bug. Projects that rely on <code>FindThrust.cmake</code> should check for this and patch their copies as follows.</p>
<p>Replace:</p>
<div class="fragment"><div class="line">string( REGEX MATCH &quot;^[0-9]&quot; major ${version} )</div><div class="line">string( REGEX REPLACE &quot;^${major}00&quot; &quot;&quot; version &quot;${version}&quot; )</div><div class="line">string( REGEX MATCH &quot;^[0-9]&quot; minor ${version} )</div><div class="line">string( REGEX REPLACE &quot;^${minor}0&quot; &quot;&quot; version &quot;${version}&quot; )</div></div><!-- fragment --><p>with:</p>
<div class="fragment"><div class="line">math(EXPR major &quot;${version} / 100000&quot;)</div><div class="line">math(EXPR minor &quot;(${version} / 100) % 1000&quot;)</div><div class="line">math(EXPR version &quot;${version} % 100&quot;)</div></div><!-- fragment --><h1>Thrust Developer Documentation</h1>
<p>This portion of the file contains descriptions of Thrust's internal CMake target structure for Thrust developers. It should not be necessary for users who just want to use Thrust from their projects.</p>
<h2>Internal Targets</h2>
<p>By default, <code>find_package(Thrust)</code> will only create a single <code>Thrust::Thrust</code> target that describes where the actual Thrust headers are located. It does not locate or create configurations for any dependencies; these are lazily loaded on-demand by calls to <code>create_thrust_target</code>, or when explicitly requested via <code>find_package</code>'s component mechanism.</p>
<p>As mentioned, the basic Thrust interface is described by the <code>Thrust::Thrust</code> target.</p>
<p>Each backend system (<code>CPP</code>, <code>CUDA</code>, <code>TBB</code>, <code>OMP</code>) is described by multiple targets:</p>
<ul>
<li><code>Thrust::${system}</code><ul>
<li>Specifies an interface configured to build against all dependencies for this backend (including <code>Thrust::Thrust</code>).</li>
<li>For example, the <code>Thrust::CUDA</code> target is an interface target that combines the interfaces of both Thrust and CUB.</li>
</ul>
</li>
<li><code>Thrust::${system}::Host</code><ul>
<li>Configures an interface for using a specific host system.</li>
<li>Multiple <code>::Host</code> targets cannot be combined in the same library/executable. Attempting to do so will produce a CMake configuration error.</li>
<li>Only defined for systems that support being used as the host.</li>
</ul>
</li>
<li><code>Thrust::${system}::Device</code><ul>
<li>Configures an interface for using a specific device system.</li>
<li>Multiple <code>::Device</code> targets cannot be combined in the same library/executable. Attempting to do so will produce a CMake configuration error.</li>
<li>Only defined for systems that support being used as the device. </li>
</ul>
</li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
